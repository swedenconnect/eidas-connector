<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:context="http://www.springframework.org/schema/context" xmlns:util="http://www.springframework.org/schema/util"
  xmlns:p="http://www.springframework.org/schema/p" xmlns:c="http://www.springframework.org/schema/c" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"

  default-init-method="initialize" default-destroy-method="destroy">
  
  <bean id="pkcs11Configuration" class="se.elegnamnden.eidas.pkcs11.PKCS11ProviderConfiguration" scope="singleton"
    p:library="%{idp.pkcs11.library}"
    p:name="%{idp.pkcs11.name}"
    p:slot="%{idp.pkcs11.slot}"
    p:slotListIndex="%{idp.pkcs11.slotListIndex}"
    p:slotListIndexMaxRange="%{idp.pkcs11.slotListIndexMaxRange}" />
      
  <bean id="pkcs11Provider" class="se.elegnamnden.eidas.pkcs11.PKCS11ProviderFactoryBean" scope="singleton" 
    c:configuration-ref="pkcs11Configuration" />
    
  <bean id="pkcs11ProviderList" factory-bean="pkcs11Provider" factory-method="getProviderNameList" scope="singleton" />
    
  <util:list id="shibboleth.SigningCredentials">
    <ref bean="shibboleth.DefaultSigningCredential" />
  </util:list>

  <bean id="shibboleth.DefaultSigningCertificate" class="net.shibboleth.ext.spring.factory.X509CertificateFactoryBean" 
    p:resource="%{idp.signing.cert}" />

  <bean id="shibboleth.DefaultSigningCredential" class="se.elegnamnden.eidas.pkcs11.PKCS11CredentialFactoryBean" scope="singleton"
    p:entityCertificate-ref="shibboleth.DefaultSigningCertificate"
    p:entityID="%{idp.entityID}"
    p:alias="%{idp.signing.pkcs11.alias}"
    p:pin="%{idp.signing.pkcs11.pin}"
    p:providerNameList-ref="pkcs11ProviderList" />

  <util:list id="sweid.SigningCertificates">  
    <ref bean="shibboleth.DefaultSigningCertificate" />
  </util:list>

  <alias alias="shibboleth.EncryptionCredentials" name="shibboleth.DefaultEncryptionCredentials" />

  <bean id="shibboleth.DefaultEncryptionCertificate" class="net.shibboleth.ext.spring.factory.X509CertificateFactoryBean" 
    p:resource="%{idp.encryption.cert}" />
    
  <bean id="shibboleth.DefaultEncryptionCredential" class="se.elegnamnden.eidas.pkcs11.PKCS11CredentialFactoryBean" scope="singleton"
    p:entityCertificate-ref="shibboleth.DefaultEncryptionCertificate"
    p:entityID="%{idp.entityID}"
    p:alias="%{idp.encryption.pkcs11.alias}"
    p:pin="%{idp.encryption.pkcs11.pin}"
    p:providerNameList-ref="pkcs11ProviderList" />    

  <util:list id="shibboleth.DefaultEncryptionCredentials">
    <ref bean="shibboleth.DefaultEncryptionCredential" />
  </util:list>

</beans>
